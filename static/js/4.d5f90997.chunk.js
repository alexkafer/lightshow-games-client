(this["webpackJsonplightshow-games-client"]=this["webpackJsonplightshow-games-client"]||[]).push([[4],{60:function(e,t,a){"use strict";a.r(t);var n=a(6),i=a(7),o=a(9),s=a(8),r=a(3),c=a(10),l=a(0),m=a.n(l),u=a(123),d=a(265),h=a(266),p=a(124),f=a(267),v=a(14);function b(e,t){window.addEventListener("deviceorientation",e,!0),window.addEventListener("compassneedscalibration",t,!0)}var E=function(e){var t=e.askPermission;return m.a.createElement("div",{className:"container center-item"},m.a.createElement("h1",{className:"mt-5"},"Activate Motion"),m.a.createElement("p",{className:"lead"},"Motion allows the light show to know where your phone is pointed."),m.a.createElement(p.a,{className:"m-1",onClick:t,variant:"primary"},"Allow"))},g=a(176),y=a(256),O=a(260),C=function(e){function t(){var e;return Object(n.a)(this,t),(e=Object(o.a)(this,Object(s.a)(t).call(this))).state={dropped:!1,left:window.innerWidth/2,top:window.innerHeight/4},e.map=m.a.createRef(),e.handleTouchStart=e.handleTouchStart.bind(Object(r.a)(e)),e.confirmPosition=e.confirmPosition.bind(Object(r.a)(e)),e}return Object(c.a)(t,e),Object(i.a)(t,[{key:"setCoords",value:function(e,t){this.setState({left:e,top:t})}},{key:"handleTouchStart",value:function(e){if(e.target&&1===e.touches.length&&"IMG"===e.target.tagName){var t=e.target.getBoundingClientRect(),a=e.touches[0];this.setCoords(a.clientX-t.left,a.clientY-t.top),console.log(a),e.preventDefault()}}},{key:"_onDrag",value:function(e){console.log(e),this.setCoords(e.left,e.top)}},{key:"_onDragEnd",value:function(){console.log("Finished dragging")}},{key:"confirmPosition",value:function(){var e=2*this.state.left/this.map.current.width-1,t=-(2*this.state.top/this.map.current.height-1);console.log(e,t),this.props.setPosition(e,t)}},{key:"render",value:function(){var e=this,t={left:this.state.left,top:this.state.top};return console.log(t),m.a.createElement("div",{className:"center-item"},m.a.createElement("h1",null,"Set your location"),m.a.createElement("div",{onTouchStart:this.handleTouchStart,className:"location-pin"},m.a.createElement("img",{ref:this.map,alt:"Light Show Map",src:"https://lightshow.centralus.cloudapp.azure.com/layout/map"}),m.a.createElement(g.Draggable,{position:t,onDrag:function(t){return e._onDrag(t)},onDragEnd:function(){return e._onDragEnd()}},m.a.createElement(y.a,{className:"pin",style:t,icon:O.a,size:"3x"}))),m.a.createElement(p.a,{onClick:this.confirmPosition,className:"m-1",variant:"primary"},"Confirm"))}}]),t}(l.Component),w=function(){return m.a.createElement("div",{className:"container center-item"},m.a.createElement("h1",{className:"mt-5"},"Not Supported"),m.a.createElement("p",{className:"lead"},"Unfortunately, this game doesn't work on this device."),m.a.createElement(p.a,{className:"m-1",href:"googlechromes://"+window.location.host,variant:"primary"},"Try in Chrome"),m.a.createElement(p.a,{className:"m-1",href:"itms-apps://itunes.apple.com/us/app/chrome/id535886823",variant:"secondary"},"Install Chrome"),m.a.createElement("p",{className:"pt-5 lead"},"iOS 12: Please enable device orientation in Settings > Safari > Motion & Orientation Access."))},N=a(37),k=function(e){var t=e.calibrate;return m.a.createElement("div",{className:"container center-item"},m.a.createElement("h1",{className:"mt-5"},"Calibrate Direction"),m.a.createElement("p",{className:"lead"},"Point your phone south and press Calibrate."),m.a.createElement(p.a,{className:"m-1",onClick:t,variant:"primary"},"Calibrate"))},S=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(o.a)(this,Object(s.a)(t).call(this,e))).state={notSupported:!1,motionTimeout:0,needsMotion:!1,needsPosition:!0,needsCalibration:!0,recordOffset:!1,offsetAlpha:0,offsetBeta:0,offsetGamma:0},a.requestOrientationPermission=a.requestOrientationPermission.bind(Object(r.a)(a)),a.handleOrientationEvent=a.handleOrientationEvent.bind(Object(r.a)(a)),a.compassNeedsCalibration=a.compassNeedsCalibration.bind(Object(r.a)(a)),a.setPosition=a.setPosition.bind(Object(r.a)(a)),a.exitGame=a.exitGame.bind(Object(r.a)(a)),a.recordCalibration=a.recordCalibration.bind(Object(r.a)(a)),a}return Object(c.a)(t,e),Object(i.a)(t,[{key:"setNotSupported",value:function(){this.setState({notSupported:!0}),this.context.emit("end")}},{key:"compassNeedsCalibration",value:function(e){alert("Your compass needs calibrating! Wave your device in a figure-eight motion."),e.preventDefault()}},{key:"recordCalibration",value:function(){this.setState({needsCalibration:!1,recordOffset:!0})}},{key:"setPosition",value:function(e,t){this.context.emit("position",{x:e,y:t}),this.setState({needsPosition:!1})}},{key:"handleOrientationEvent",value:function(e){0!==this.state.motionTimeout&&clearTimeout(this.state.motionTimeout),this.state.recordOffset&&this.setState({recordOffset:!1,offsetAlpha:e.alpha,offsetBeta:e.beta,offsetGamma:e.gamma});var t={alpha:e.alpha-this.state.offsetAlpha,beta:e.beta-this.state.offsetBeta,gamma:e.gamma-this.state.offsetGamma,compass:e.webkitCompassHeading,compass_accuracy:e.webkitCompassAccuracy};this.context.emit("odometry",t)}},{key:"requestOrientationPermission",value:function(){var e=this;console.log("Requesting permission."),DeviceOrientationEvent.requestPermission().then((function(t){console.log(t),"granted"===t?(b(e.handleOrientationEvent,e.compassNeedsCalibration),e.setState({needsMotion:!1})):"denied"===t&&e.setNotSupported()})).catch(console.error)}},{key:"exitGame",value:function(){console.log("Exiting"),this.context.emit("end")}},{key:"componentDidMount",value:function(){var e=this;if(void 0!==window.DeviceMotionEvent){var t=typeof DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission;this.setState({needsMotion:t}),t||(b(this.handleOrientationEvent,this.compassNeedsCalibration),this.setState({motionTimeout:setTimeout((function(){e.setNotSupported()}),1e3)}))}else this.setNotSupported()}},{key:"componentWillUnmount",value:function(){var e,t;e=this.handleOrientationEvent,t=this.compassNeedsCalibration,window.removeEventListener("deviceorientation",e,!0),window.addEventListener("compassneedscalibration",t,!0)}},{key:"render",value:function(){var e=this,t=m.a.createElement(u.a,null,m.a.createElement(d.a,null,m.a.createElement(h.a,null,m.a.createElement(p.a,{onClick:function(){return e.setState({needsPosition:!0})}},"Update Location")),m.a.createElement(h.a,null,m.a.createElement(p.a,{onClick:function(){return e.setState({needsCalibration:!0})}},"Calibrate"))),m.a.createElement(d.a,null,m.a.createElement(h.a,null,m.a.createElement("h1",{className:"mt-5"},"Now Playing"))));return this.state.notSupported?t=m.a.createElement(w,null):this.state.needsMotion?t=m.a.createElement(E,{askPermission:this.requestOrientationPermission}):this.state.needsPosition?t=m.a.createElement(C,{setPosition:this.setPosition}):this.state.needsCalibration&&(t=m.a.createElement(k,{calibrate:this.recordCalibration})),m.a.createElement(m.a.Fragment,null,m.a.createElement(f.a,{bg:"dark",expand:"lg",variant:"dark"},m.a.createElement(f.a.Brand,null,"Wand"),m.a.createElement(N.a,null)),t)}}]),t}(l.Component);S.contextType=v.a;t.default=S}}]);
//# sourceMappingURL=4.d5f90997.chunk.js.map